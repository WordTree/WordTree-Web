{"version":3,"file":"dropdown.vue_vue_type_script_lang.js","sources":["../../../../../../packages/components/dropdown/src/dropdown.vue"],"sourcesContent":["<template>\n  <div class=\"el-dropdown\">\n    <el-popper\n      ref=\"triggerVnode\"\n      v-model:visible=\"visible\"\n      :placement=\"placement\"\n      :fallback-placements=\"['bottom', 'top', 'right', 'left']\"\n      :effect=\"effect\"\n      pure\n      :manual-mode=\"true\"\n      :trigger=\"[trigger]\"\n      popper-class=\"el-dropdown__popper\"\n      append-to-body\n      transition=\"el-zoom-in-top\"\n      :stop-popper-mouse-event=\"false\"\n      :gpu-acceleration=\"false\"\n    >\n      <template #default>\n        <el-scrollbar\n          ref=\"scrollbar\"\n          tag=\"ul\"\n          :wrap-style=\"wrapStyle\"\n          view-class=\"el-dropdown__list\"\n        >\n          <slot name=\"dropdown\"></slot>\n        </el-scrollbar>\n      </template>\n      <template #trigger>\n        <div :class=\"[dropdownSize ? 'el-dropdown--' + dropdownSize : '']\">\n          <slot v-if=\"!splitButton\" name=\"default\"></slot>\n          <template v-else>\n            <el-button-group>\n              <el-button\n                :size=\"dropdownSize\"\n                :type=\"type\"\n                @click=\"handlerMainButtonClick\"\n              >\n                <slot name=\"default\"></slot>\n              </el-button>\n              <el-button\n                :size=\"dropdownSize\"\n                :type=\"type\"\n                class=\"el-dropdown__caret-button\"\n              >\n                <el-icon class=\"el-dropdown__icon\"><arrow-down /></el-icon>\n              </el-button>\n            </el-button-group>\n          </template>\n        </div>\n      </template>\n    </el-popper>\n  </div>\n</template>\n<script lang=\"ts\">\nimport {\n  defineComponent,\n  provide,\n  getCurrentInstance,\n  ref,\n  computed,\n  watch,\n  onMounted,\n} from 'vue'\nimport ElButton from '@element-plus/components/button'\nimport ElPopper, { Effect } from '@element-plus/components/popper'\nimport ElScrollbar from '@element-plus/components/scrollbar'\nimport ElIcon from '@element-plus/components/icon'\nimport { on, addClass, removeClass } from '@element-plus/utils/dom'\nimport { addUnit } from '@element-plus/utils/util'\nimport { ArrowDown } from '@element-plus/icons'\nimport { useDropdown } from './useDropdown'\n\nimport type { Placement } from '@element-plus/components/popper'\nimport type { PropType, ComponentPublicInstance, CSSProperties } from 'vue'\nimport type { TriggerType } from '@element-plus/hooks/use-popper/use-target-events'\nimport type { ButtonType } from '@element-plus/components/button/src/types'\n\ntype Nullable<T> = null | T\nconst { ButtonGroup: ElButtonGroup } = ElButton\n\nexport default defineComponent({\n  name: 'ElDropdown',\n  components: {\n    ElButton,\n    ElButtonGroup,\n    ElScrollbar,\n    ElPopper,\n    ElIcon,\n    ArrowDown,\n  },\n  props: {\n    trigger: {\n      type: String as PropType<TriggerType | 'contextmenu'>,\n      default: 'hover',\n    },\n    type: String as PropType<ButtonType>,\n    size: {\n      type: String,\n      default: '',\n    },\n    splitButton: Boolean,\n    hideOnClick: {\n      type: Boolean,\n      default: true,\n    },\n    placement: {\n      type: String as PropType<Placement>,\n      default: 'bottom',\n    },\n    showTimeout: {\n      type: Number,\n      default: 150,\n    },\n    hideTimeout: {\n      type: Number,\n      default: 150,\n    },\n    tabindex: {\n      type: [Number, String],\n      default: 0,\n    },\n    effect: {\n      type: String as PropType<Effect>,\n      default: Effect.LIGHT,\n    },\n    maxHeight: {\n      type: [Number, String],\n      default: '',\n    },\n  },\n  emits: ['visible-change', 'click', 'command'],\n  setup(props, { emit }) {\n    const _instance = getCurrentInstance()\n    const { ELEMENT } = useDropdown()\n\n    const timeout = ref<Nullable<number>>(null)\n\n    const visible = ref(false)\n    const scrollbar = ref(null)\n    const wrapStyle = computed<CSSProperties>(() => ({\n      maxHeight: addUnit(props.maxHeight),\n    }))\n\n    watch(\n      () => visible.value,\n      (val) => {\n        if (val) triggerElmFocus()\n        if (!val) triggerElmBlur()\n        emit('visible-change', val)\n      }\n    )\n\n    const focusing = ref(false)\n    watch(\n      () => focusing.value,\n      (val) => {\n        const selfDefine = triggerElm.value\n        if (selfDefine) {\n          if (val) {\n            addClass(selfDefine, 'focusing')\n          } else {\n            removeClass(selfDefine, 'focusing')\n          }\n        }\n      }\n    )\n\n    const triggerVnode = ref<Nullable<ComponentPublicInstance>>(null)\n    const triggerElm = computed<Nullable<HTMLButtonElement>>(() => {\n      const _: any = (triggerVnode.value?.$refs.triggerRef as HTMLElement)\n        ?.children[0]\n      return !props.splitButton ? _ : _?.children?.[1]\n    })\n\n    function handleClick() {\n      if (triggerElm.value?.disabled) return\n      if (visible.value) {\n        hide()\n      } else {\n        show()\n      }\n    }\n\n    function show() {\n      if (triggerElm.value?.disabled) return\n      timeout.value && clearTimeout(timeout.value)\n      timeout.value = window.setTimeout(\n        () => {\n          visible.value = true\n        },\n        ['click', 'contextmenu'].includes(props.trigger) ? 0 : props.showTimeout\n      )\n    }\n\n    function hide() {\n      if (triggerElm.value?.disabled) return\n      removeTabindex()\n      if (props.tabindex >= 0) {\n        resetTabindex(triggerElm.value)\n      }\n      clearTimeout(timeout.value)\n      timeout.value = window.setTimeout(\n        () => {\n          visible.value = false\n        },\n        ['click', 'contextmenu'].includes(props.trigger) ? 0 : props.hideTimeout\n      )\n    }\n\n    function removeTabindex() {\n      triggerElm.value?.setAttribute('tabindex', '-1')\n    }\n\n    function resetTabindex(ele) {\n      removeTabindex()\n      ele?.setAttribute('tabindex', '0')\n    }\n\n    function triggerElmFocus() {\n      triggerElm.value?.focus?.()\n    }\n\n    function triggerElmBlur() {\n      triggerElm.value?.blur?.()\n    }\n\n    const dropdownSize = computed(() => props.size || ELEMENT.size)\n\n    function commandHandler(...args) {\n      emit('command', ...args)\n    }\n\n    provide('elDropdown', {\n      instance: _instance,\n      dropdownSize,\n      visible,\n      handleClick,\n      commandHandler,\n      show,\n      hide,\n      trigger: computed(() => props.trigger),\n      hideOnClick: computed(() => props.hideOnClick),\n      triggerElm,\n    })\n\n    onMounted(() => {\n      if (!props.splitButton) {\n        on(triggerElm.value, 'focus', () => {\n          focusing.value = true\n        })\n        on(triggerElm.value, 'blur', () => {\n          focusing.value = false\n        })\n        on(triggerElm.value, 'click', () => {\n          focusing.value = false\n        })\n      }\n      if (props.trigger === 'hover') {\n        on(triggerElm.value, 'mouseenter', show)\n        on(triggerElm.value, 'mouseleave', hide)\n      } else if (props.trigger === 'click') {\n        on(triggerElm.value, 'click', handleClick)\n      } else if (props.trigger === 'contextmenu') {\n        on(triggerElm.value, 'contextmenu', (e) => {\n          e.preventDefault()\n          handleClick()\n        })\n      }\n\n      Object.assign(_instance, {\n        handleClick,\n        hide,\n        resetTabindex,\n      })\n    })\n\n    const handlerMainButtonClick = (event) => {\n      emit('click', event)\n      hide()\n    }\n\n    return {\n      visible,\n      scrollbar,\n      wrapStyle,\n      dropdownSize,\n      handlerMainButtonClick,\n      triggerVnode,\n    }\n  },\n})\n</script>\n"],"names":["ElButton","defineComponent","ElScrollbar","ElPopper","ElIcon","ArrowDown","Effect","getCurrentInstance","useDropdown","ref","computed","addUnit"],"mappings":";;;;;;;;;;;;;;;AA8EA,MAAM,EAAE,aAAa,kBAAkBA;AAEvC,aAAeC,oBAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,YAAY;AAAA,cACVD;AAAA,IACA;AAAA,iBACAE;AAAA,cACAC;AAAA,YACAC;AAAA,eACAC;AAAA;AAAA,EAEF,OAAO;AAAA,IACL,SAAS;AAAA,MACP,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,MAAM;AAAA,IACN,MAAM;AAAA,MACJ,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,aAAa;AAAA,IACb,aAAa;AAAA,MACX,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,WAAW;AAAA,MACT,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,aAAa;AAAA,MACX,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,aAAa;AAAA,MACX,MAAM;AAAA,MACN,SAAS;AAAA;AAAA,IAEX,UAAU;AAAA,MACR,MAAM,CAAC,QAAQ;AAAA,MACf,SAAS;AAAA;AAAA,IAEX,QAAQ;AAAA,MACN,MAAM;AAAA,MACN,SAASC,gBAAO;AAAA;AAAA,IAElB,WAAW;AAAA,MACT,MAAM,CAAC,QAAQ;AAAA,MACf,SAAS;AAAA;AAAA;AAAA,EAGb,OAAO,CAAC,kBAAkB,SAAS;AAAA,EACnC,MAAM,OAAO,EAAE,QAAQ;AACrB,UAAM,YAAYC;AAClB,UAAM,EAAE,YAAYC;AAEpB,UAAM,UAAUC,QAAsB;AAEtC,UAAM,UAAUA,QAAI;AACpB,UAAM,YAAYA,QAAI;AACtB,UAAM,YAAYC,aAAwB;AAAO,MAC/C,WAAWC,aAAQ,MAAM;AAAA;AAG3B,cACE,MAAM,QAAQ,OACd,CAAC,QAAQ;AACP,UAAI;AAAK;AACT,UAAI,CAAC;AAAK;AACV,WAAK,kBAAkB;AAAA;AAI3B,UAAM,WAAWF,QAAI;AACrB,cACE,MAAM,SAAS,OACf,CAAC,QAAQ;AACP,YAAM,aAAa,WAAW;AAC9B,UAAI,YAAY;AACd,YAAI,KAAK;AACP,uBAAS,YAAY;AAAA,eAChB;AACL,0BAAY,YAAY;AAAA;AAAA;AAAA;AAMhC,UAAM,eAAeA,QAAuC;AAC5D,UAAM,aAAaC,aAAsC,MAAM;;AAC7D,YAAM,IAAU,yBAAa,UAAb,mBAAoB,MAAM,eAA1B,mBACZ,SAAS;AACb,aAAO,CAAC,MAAM,cAAc,IAAI,6BAAG,aAAH,mBAAc;AAAA;AAGhD,2BAAuB;;AACrB,UAAI,iBAAW,UAAX,mBAAkB;AAAU;AAChC,UAAI,QAAQ,OAAO;AACjB;AAAA,aACK;AACL;AAAA;AAAA;AAIJ,oBAAgB;;AACd,UAAI,iBAAW,UAAX,mBAAkB;AAAU;AAChC,cAAQ,SAAS,aAAa,QAAQ;AACtC,cAAQ,QAAQ,OAAO,WACrB,MAAM;AACJ,gBAAQ,QAAQ;AAAA,SAElB,CAAC,SAAS,eAAe,SAAS,MAAM,WAAW,IAAI,MAAM;AAAA;AAIjE,oBAAgB;;AACd,UAAI,iBAAW,UAAX,mBAAkB;AAAU;AAChC;AACA,UAAI,MAAM,YAAY,GAAG;AACvB,sBAAc,WAAW;AAAA;AAE3B,mBAAa,QAAQ;AACrB,cAAQ,QAAQ,OAAO,WACrB,MAAM;AACJ,gBAAQ,QAAQ;AAAA,SAElB,CAAC,SAAS,eAAe,SAAS,MAAM,WAAW,IAAI,MAAM;AAAA;AAIjE,8BAA0B;;AACxB,uBAAW,UAAX,mBAAkB,aAAa,YAAY;AAAA;AAG7C,2BAAuB,KAAK;AAC1B;AACA,iCAAK,aAAa,YAAY;AAAA;AAGhC,+BAA2B;;AACzB,6BAAW,UAAX,mBAAkB,UAAlB;AAAA;AAGF,8BAA0B;;AACxB,6BAAW,UAAX,mBAAkB,SAAlB;AAAA;AAGF,UAAM,eAAeA,aAAS,MAAM,MAAM,QAAQ,QAAQ;AAE1D,+BAA2B,MAAM;AAC/B,WAAK,WAAW,GAAG;AAAA;AAGrB,gBAAQ,cAAc;AAAA,MACpB,UAAU;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAASA,aAAS,MAAM,MAAM;AAAA,MAC9B,aAAaA,aAAS,MAAM,MAAM;AAAA,MAClC;AAAA;AAGF,kBAAU,MAAM;AACd,UAAI,CAAC,MAAM,aAAa;AACtB,eAAG,WAAW,OAAO,SAAS,MAAM;AAClC,mBAAS,QAAQ;AAAA;AAEnB,eAAG,WAAW,OAAO,QAAQ,MAAM;AACjC,mBAAS,QAAQ;AAAA;AAEnB,eAAG,WAAW,OAAO,SAAS,MAAM;AAClC,mBAAS,QAAQ;AAAA;AAAA;AAGrB,UAAI,MAAM,YAAY,SAAS;AAC7B,eAAG,WAAW,OAAO,cAAc;AACnC,eAAG,WAAW,OAAO,cAAc;AAAA,iBAC1B,MAAM,YAAY,SAAS;AACpC,eAAG,WAAW,OAAO,SAAS;AAAA,iBACrB,MAAM,YAAY,eAAe;AAC1C,eAAG,WAAW,OAAO,eAAe,CAAC,MAAM;AACzC,YAAE;AACF;AAAA;AAAA;AAIJ,aAAO,OAAO,WAAW;AAAA,QACvB;AAAA,QACA;AAAA,QACA;AAAA;AAAA;AAIJ,UAAM,yBAAyB,CAAC,UAAU;AACxC,WAAK,SAAS;AACd;AAAA;AAGF,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA;AAAA;;;;"}